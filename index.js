import"dotenv/config";import f from"express";import g from"path";import D from"staticify";import{fileURLToPath as N}from"url";import{getFileAsset as Y,getImageAsset as q}from"@sanity/asset-utils";import{toHTML as C}from"@portabletext/to-html";import"dotenv/config";import{createClient as L}from"@sanity/client";var S=L({apiVersion:process.env.SANITY_API,dataset:process.env.SANITY_DATABASE,projectId:process.env.SANITY_PROJECT,useCdn:!0});import x from"express";var b=async(s,t)=>{let{email:n}=s.body;try{let o=JSON.stringify({data:{type:"profile-subscription-bulk-create-job",attributes:{profiles:{data:[{type:"profile",attributes:{subscriptions:{email:{marketing:{consent:"SUBSCRIBED"}}},email:n}}]},historical_import:!1},relationships:{list:{data:{id:process.env.KLAVIYO_LIST_ID,type:"list"}}}}}),e="https://a.klaviyo.com/api/profile-subscription-bulk-create-jobs",u={method:"POST",headers:{accept:"application/vnd.api+json",revision:"2025-04-15","content-type":"application/vnd.api+json",Authorization:`Klaviyo-API-Key ${process.env.KLAVIYO_API_KEY}`},body:o},a=await fetch(e,u);a.status===202?t.status(202).send("Successfully subscribed!"):t.status(a.status).send("Subscription failed.")}catch(o){console.error("Error Subscribing:",o),t.status(500).send("An error occurred.")}};import*as v from"fs";import{UAParser as O}from"ua-parser-js";var w=process.env.NODE_ENV==="production"?"./content.json":"../content.json",E=v.readFileSync(new URL(w,import.meta.url),"utf-8"),d=JSON.parse(E);function c(s){let t=process.env.GOOGLE_ANALYTICS,n=process.env.TYPEKIT,o=s.params.slug??"home",e=O(s.headers["user-agent"]),u=e.device.type===void 0,a=e.device.type==="mobile",h=e.device.type==="tablet",{categories:T,footer:_,menu:P,settings:j}=d,y=[...d.pages,...d.products],l=y.find(m=>m.slug.current===o);return l||(l=y.find(m=>m.slug.current==="not-found")),{analytics:t,typekit:n,categories:T,footer:_,menu:P,settings:j,...l,isDesktop:u,isPhone:a,isTablet:h}}var p=async(s,t)=>{t.render("pages/page",{...c(s)})};var i=x.Router();i.get("/",p);i.get("/:slug",p);i.get("/product/:slug",p);i.post("/signup",b);i.use((s,t)=>{let n=c(s);t.status(404),t.render("pages/page",{...n})});var F=N(import.meta.url),I=g.dirname(F),r=f();r.use(f.json());r.use(f.urlencoded());var R=D(g.join(I,"build"));r.use(R.middleware);r.set("views",g.join(I,"views"));r.set("view engine","twig");r.use((s,t,n)=>{t.locals.getVersionedPath=R.getVersionedPath;let o=S.config();t.locals.getAsset=e=>q(e,{baseUrl:o.apiHost,projectId:o.projectId,dataset:o.dataset}),t.locals.getFile=e=>Y(e,o),t.locals.parseHTML=e=>{if(e)return C(e)},t.locals.lowercase=e=>e.toLowerCase(),n()});r.use("/",i);var A=process.env.PORT||3e3;r.listen(A,()=>{console.log(`App listening on port ${A}`)});var pt=r;export{pt as default};
//# sourceMappingURL=index.js.map